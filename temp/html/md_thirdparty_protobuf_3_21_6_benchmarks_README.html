<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Protocol Buffers Benchmarks</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'搜索','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','搜索');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Protocol Buffers Benchmarks </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This directory contains benchmarking schemas and data sets that you can use to test a variety of performance scenarios against your protobuf language runtime. If you are looking for performance numbers of officially supported languages, see <a href="https://github.com/protocolbuffers/protobuf/blob/main/docs/performance.md">Protobuf Performance</a>.</p>
<h1><a class="anchor" id="autotoc_md60"></a>
Prerequisite</h1>
<p>First, you need to follow the instruction in the root directory's README to build your language's protobuf, then:</p>
<h2><a class="anchor" id="autotoc_md61"></a>
CPP</h2>
<p>You need to install <a href="https://cmake.org/">cmake</a> before building the benchmark.</p>
<p>We are using <a href="https://github.com/google/benchmark">google/benchmark</a> as the benchmark tool for testing cpp. This will be automatically made during build the cpp benchmark.</p>
<p>The cpp protobuf performance can be improved by linking with <a href="https://google.github.io/tcmalloc">TCMalloc</a>.</p>
<h2><a class="anchor" id="autotoc_md62"></a>
Java</h2>
<p>We're using maven to build the java benchmarks, which is the same as to build the Java protobuf. There're no other tools need to install. We're using <a href="https://github.com/google/caliper">google/caliper</a> as benchmark tool, which can be automatically included by maven.</p>
<h2><a class="anchor" id="autotoc_md63"></a>
Python</h2>
<p>We're using python C++ API for testing the generated CPP proto version of python protobuf, which is also a prerequisite for Python protobuf cpp implementation. You need to install the correct version of Python C++ extension package before run generated CPP proto version of Python protobuf's benchmark. e.g. under Ubuntu, you need to</p>
<div class="fragment"><div class="line">$ sudo apt-get install python-dev</div>
<div class="line">$ sudo apt-get install python3-dev</div>
</div><!-- fragment --><p> And you also need to make sure <code>pkg-config</code> is installed.</p>
<h2><a class="anchor" id="autotoc_md64"></a>
Go</h2>
<p>Go protobufs are maintained at <a href="http://github.com/golang/protobuf">github.com/golang/protobuf</a>. If not done already, you need to install the toolchain and the Go protoc-gen-go plugin for protoc.</p>
<p>To install protoc-gen-go, run:</p>
<div class="fragment"><div class="line">$ go get -u github.com/golang/protobuf/protoc-gen-go</div>
<div class="line">$ export PATH=$PATH:$(go env GOPATH)/bin</div>
</div><!-- fragment --><p>The first command installs <code>protoc-gen-go</code> into the <code>bin</code> directory in your local <code>GOPATH</code>. The second command adds the <code>bin</code> directory to your <code>PATH</code> so that <code>protoc</code> can locate the plugin later.</p>
<h2><a class="anchor" id="autotoc_md65"></a>
PHP</h2>
<p>PHP benchmark's requirement is the same as PHP protobuf's requirements. The benchmark will automatically include PHP protobuf's src and build the c extension if required.</p>
<h2><a class="anchor" id="autotoc_md66"></a>
Node.js</h2>
<p>Node.js benchmark need <a href="https://nodejs.org/en/">node</a>(higher than V6) and <a href="https://www.npmjs.com/">npm</a> package manager installed. This benchmark is using the <a href="https://www.npmjs.com/package/benchmark">benchmark</a> framework to test, which needn't to manually install. And another prerequisite is <a href="https://github.com/protocolbuffers/protobuf/tree/main/js">protobuf js</a>, which needn't to manually install either</p>
<h2><a class="anchor" id="autotoc_md67"></a>
C</h2>
<p>The C# benchmark code is built as part of the main Google.Protobuf solution. It requires the .NET Core SDK, and depends on <a href="https://github.com/dotnet/BenchmarkDotNet">BenchmarkDotNet</a>, which will be downloaded automatically.</p>
<h1><a class="anchor" id="autotoc_md68"></a>
Run instructions</h1>
<p>To run all the benchmark dataset:</p>
<h2><a class="anchor" id="autotoc_md69"></a>
Java:</h2>
<p>First build the Java binary in the usual way with Maven:</p>
<div class="fragment"><div class="line">$ cd java</div>
<div class="line">$ mvn install</div>
</div><!-- fragment --><p>Assuming that completes successfully,</p>
<div class="fragment"><div class="line">$ cd ../benchmarks</div>
<div class="line">$ make java</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md70"></a>
CPP:</h2>
<div class="fragment"><div class="line">$ make cpp</div>
</div><!-- fragment --><p>For linking with tcmalloc:</p>
<div class="fragment"><div class="line">$ env LD_PRELOAD={directory to libtcmalloc.so} make cpp</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md71"></a>
Python:</h2>
<p>We have three versions of python protobuf implementation: pure python, cpp reflection and cpp generated code. To run these version benchmark, you need to:</p>
<h3><a class="anchor" id="autotoc_md72"></a>
Pure Python:</h3>
<div class="fragment"><div class="line">$ make python-pure-python</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md73"></a>
CPP reflection:</h3>
<div class="fragment"><div class="line">$ make python-cpp-reflection</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md74"></a>
CPP generated code:</h3>
<div class="fragment"><div class="line">$ make python-cpp-generated-code</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md75"></a>
Go</h2>
<div class="fragment"><div class="line">$ make go</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md76"></a>
PHP</h2>
<p>We have two version of php protobuf implementation: pure php, php with c extension. To run these version benchmark, you need to: </p>
<h3><a class="anchor" id="autotoc_md77"></a>
Pure PHP</h3>
<div class="fragment"><div class="line">$ make php</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md78"></a>
PHP with c extension</h3>
<div class="fragment"><div class="line">$ make php_c</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md79"></a>
Node.js</h2>
<div class="fragment"><div class="line">$ make js</div>
</div><!-- fragment --><p>To run a specific dataset or run with specific options:</p>
<h2><a class="anchor" id="autotoc_md80"></a>
Java:</h2>
<div class="fragment"><div class="line">$ make java-benchmark</div>
<div class="line">$ ./java-benchmark $(specific generated dataset file name) [$(caliper options)]</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md81"></a>
CPP:</h2>
<div class="fragment"><div class="line">$ make cpp-benchmark</div>
<div class="line">$ ./cpp-benchmark $(specific generated dataset file name) [$(benchmark options)]</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md82"></a>
Python:</h2>
<p>For Python benchmark we have <code>--json</code> for outputting the json result</p>
<h3><a class="anchor" id="autotoc_md83"></a>
Pure Python:</h3>
<div class="fragment"><div class="line">$ make python-pure-python-benchmark</div>
<div class="line">$ ./python-pure-python-benchmark [--json] $(specific generated dataset file name)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md84"></a>
CPP reflection:</h3>
<div class="fragment"><div class="line">$ make python-cpp-reflection-benchmark</div>
<div class="line">$ ./python-cpp-reflection-benchmark [--json] $(specific generated dataset file name)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md85"></a>
CPP generated code:</h3>
<div class="fragment"><div class="line">$ make python-cpp-generated-code-benchmark</div>
<div class="line">$ ./python-cpp-generated-code-benchmark [--json] $(specific generated dataset file name)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md86"></a>
Go:</h2>
<div class="fragment"><div class="line">$ make go-benchmark</div>
<div class="line">$ ./go-benchmark $(specific generated dataset file name) [go testing options]</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md87"></a>
PHP</h2>
<h3><a class="anchor" id="autotoc_md88"></a>
Pure PHP</h3>
<div class="fragment"><div class="line">$ make php-benchmark</div>
<div class="line">$ ./php-benchmark $(specific generated dataset file name)</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md89"></a>
PHP with c extension</h3>
<div class="fragment"><div class="line">$ make php-c-benchmark</div>
<div class="line">$ ./php-c-benchmark $(specific generated dataset file name)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md90"></a>
Node.js</h2>
<div class="fragment"><div class="line">$ make js-benchmark</div>
<div class="line">$ ./js-benchmark $(specific generated dataset file name)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md91"></a>
C</h2>
<p>From <code>csharp/src/Google.Protobuf.Benchmarks</code>, run:</p>
<div class="fragment"><div class="line">$ dotnet run -c Release</div>
</div><!-- fragment --><p>We intend to add support for this within the makefile in due course.</p>
<h1><a class="anchor" id="autotoc_md92"></a>
Benchmark datasets</h1>
<p>Each data set is in the format of benchmarks.proto:</p>
<ol type="1">
<li>name is the benchmark dataset's name.</li>
<li>message_name is the benchmark's message type full name (including package and message name)</li>
<li>payload is the list of raw data.</li>
</ol>
<p>The schema for the datasets is described in <code>benchmarks.proto</code>.</p>
<p>Benchmark likely want to run several benchmarks against each data set (parse, serialize, possibly JSON, possibly using different APIs, etc).</p>
<p>We would like to add more data sets. In general we will favor data sets that make the overall suite diverse without being too large or having too many similar tests. Ideally everyone can run through the entire suite without the test run getting too long. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
制作者&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
